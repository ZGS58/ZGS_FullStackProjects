<!-- product area -->
<section id="product-area" style="padding: 6vw 10%; background-color: #f9f9f9;">
    <!-- 通知訊息 -->
    <div class="notification" [class.show]="showNotificationDiv" [class.success]="notificationType === 'success'"
        [class.error]="notificationType === 'error'" [class.info]="notificationType === 'info'">
        <span class="notification-icon">
            <ng-container *ngIf="notificationType === 'success'">✓</ng-container>
            <ng-container *ngIf="notificationType === 'error'">✕</ng-container>
            <ng-container *ngIf="notificationType === 'info'">ℹ</ng-container>
        </span>
        <span class="notification-message">{{ notificationMessage }}</span>
    </div>

    <h2 data-aos="fade-up" style="font-size: 2.5rem; color: #405751; font-family: 'Cormorant Garamond', serif;">商品一覽
    </h2>
    <p data-aos="fade-up" style="margin: 1rem 0 2rem; color: #555; font-size: 1.1rem;">
        探索我們為你精選的每一項療癒選品，結合感官、記憶與美學的旅程。
    </p>

    <div class="product-grid">
        <div class="product-card" *ngFor="let item of productList;let i = index" data-aos="fade-up">
            <img src="{{ item.imageUrl }}" alt="商品圖片" />
            <h3>{{ item.name }}</h3>
            <p>{{ item.description }}</p>
            <p class="stock-info" *ngIf="item.stock !== undefined">
                <strong>庫存：</strong>{{ item.stock }} 件
            </p>
            <div class="price">${{ item.price }}</div>
            <a href="javascript:void(0)" class="product-btn" (click)="viewProductDetail(item)"
                [class.disabled]="item.stock === 0">
                {{ item.stock === 0 ? '已售完' : '查看更多' }}
            </a>
        </div>
    </div>

    <!-- 商品詳情彈窗 -->
    <div class="product-detail-modal" *ngIf="selectedProduct" (click)="closeDetail()">
        <div class="modal-content" (click)="$event.stopPropagation()">
            <button class="close-btn" (click)="closeDetail()">×</button>
            <div class="detail-container">
                <div class="detail-image">
                    <img [src]="selectedProduct.imageUrl" [alt]="selectedProduct.name" />
                </div>
                <div class="detail-info">
                    <h2>{{ selectedProduct.name }}</h2>
                    <p class="description">{{ selectedProduct.description }}</p>
                    <p class="stock-info" *ngIf="selectedProduct.stock !== undefined">
                        <strong>庫存：</strong>{{ selectedProduct.stock }} 件
                    </p>
                    <div class="price">${{ selectedProduct.price }}</div>

                    <!-- 加入購物車區域 -->
                    <div class="add-to-cart-section"
                        *ngIf="isLoggedIn && selectedProduct.stock && selectedProduct.stock > 0">
                        <div class="quantity-selector">
                            <label>數量：</label>
                            <button
                                (click)="addToCartQuantity = addToCartQuantity > 1 ? addToCartQuantity - 1 : 1">-</button>
                            <input type="number" [(ngModel)]="addToCartQuantity" min="1"
                                [max]="selectedProduct.stock || 99" />
                            <button
                                (click)="addToCartQuantity = addToCartQuantity < (selectedProduct.stock || 99) ? addToCartQuantity + 1 : (selectedProduct.stock || 99)">+</button>
                        </div>
                        <button class="add-to-cart-btn" (click)="addToCart()">加入購物車</button>
                    </div>
                    <div class="unavailable-prompt"
                        *ngIf="isLoggedIn && (!selectedProduct.stock || selectedProduct.stock === 0)">
                        <p>此商品目前已售完</p>
                    </div>
                    <div class="login-prompt" *ngIf="!isLoggedIn">
                        <p>請先登入以使用購物車功能</p>
                    </div>
                </div>
            </div>

            <!-- 評論區 -->
            <div class="reviews-section">
                <h3>商品評論</h3>

                <!-- 評論表單 -->
                <div class="review-form" *ngIf="isLoggedIn">
                    <h4>留下您的評論</h4>
                    <div class="rating-input">
                        <label>評分：</label>
                        <select [(ngModel)]="newReview.rating">
                            <option [value]="5">⭐⭐⭐⭐⭐ (5星)</option>
                            <option [value]="4">⭐⭐⭐⭐ (4星)</option>
                            <option [value]="3">⭐⭐⭐ (3星)</option>
                            <option [value]="2">⭐⭐ (2星)</option>
                            <option [value]="1">⭐ (1星)</option>
                        </select>
                    </div>
                    <textarea [(ngModel)]="newReview.comment" placeholder="寫下您的使用心得..." rows="4"></textarea>
                    <button (click)="submitReview()" class="submit-btn">送出評論</button>
                </div>
                <div class="login-prompt" *ngIf="!isLoggedIn">
                    <p>請先登入以留下評論</p>
                </div>

                <!-- 評論列表 -->
                <div class="reviews-list">
                    <div class="review-item" *ngFor="let review of reviews">
                        <div class="review-header">
                            <span class="reviewer-name">{{ review.username }}</span>
                            <span class="review-rating">{{ '⭐'.repeat(review.rating) }}</span>
                            <span class="review-date">{{ review.createdAt | date:'yyyy/MM/dd' }}</span>
                        </div>
                        <p class="review-comment">{{ review.comment }}</p>
                    </div>
                    <p class="no-reviews" *ngIf="reviews.length === 0">目前尚無評論</p>
                </div>
            </div>
        </div>
    </div>
</section>
